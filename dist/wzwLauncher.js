/* wzwgame v1.0.0 by Microanswer,doc:http://test.microanswer.cn/wzwgame/index.html */
!function(t){var u=t.WzwScreen;function s(t,e){this.screen=new u(t,e),this.games=[],this.atoms=void 0,this.currentGame=void 0,this.screen.regLogic(function(){if(this.status===s.STATUS.OFFED||this.status===s.STATUS.OFFINGHALF)return this.screen.updateAtomArr(null),this.screen.updateStatusAtoms(null),this.screen.setScore(0),this.screen.setLevel(0),this.screen.setBest(0),void this.screen.setPause(!1);if(this.status===s.STATUS.BOOTING)return;if(!this.games||this.games.length<=0)return this.atoms=function(){if(this.emptyArr)return this.emptyArr;var r=this,s=Math.floor(r.screen.option.atomRowCount/2)-4;return this.emptyArr=r.screen.makeNewArr(function(t,e){return t<s||t>=r.screen.option.atomRowCount-s?1:0}),u.mergeArr(u.LETTER.M,r.emptyArr,1+s,2),console.log("目前还没有注册任何游戏。"),this.emptyArr}.call(this),this.screen.updateAtomArr(this.atoms),void this.screen.updateStatusAtoms(null);this.currentGame?(this.atoms=this.currentGame.onUpdate(),this.statusAtoms=this.currentGame.onUpdateStatus()):(this.atoms=function(){var t=this,e=t.games[this.current],r=t.letterCache[e.letter],n=Math.floor(t.screen.option.atomRowCount/2);{var i;r||(i=u.LETTER[e.letter],r=t.screen.makeNewArr(function(t,e){if(t<=n){var r=t-3,s=e-3;return!(i.length>r&&-1<r&&i[r].length>s&&-1<s)||0===i[r][s]?1:0}return 0}),t.letterCache[e.letter]=r)}return u.mergeArr(e.game.getPreviewAtoms(),r,n+1,0),r}.call(this),this.statusAtoms=void 0);this.screen.updateAtomArr(this.atoms),this.screen.updateStatusAtoms(this.statusAtoms)}.bind(this)),this.letterCache={},this.current=0,this.status=s.STATUS.OFFED}s.prototype.regGame=function(t,e){this.games.push({game:e,letter:t}),e.onRegLaunch(this)},s.prototype.nextGame=function(){this.currentGame||this.current>=this.games.length-1||this.current++},s.prototype.prevGame=function(){this.currentGame||this.current<=0||this.current--},s.prototype.start=function(){var r=this;r.starting||(r.starting=!0,r.status===s.STATUS.BOOTED&&0<r.games.length&&(r.currentGame||(r.status=s.STATUS.GAMEING,r.screen.playAnim(u.ANIM.COP,function(t,e){0===e?(r.currentGame=r.games[r.current].game,r.starting=!1):1===e?r.currentGame.onLaunch():-1===e&&(r.currentGame?r.status=s.STATUS.GAMEING:r.status=s.STATUS.BOOTED,r.starting=!1)}))))},s.prototype.exitCurentGame=function(){this.status=s.STATUS.BOOTED,this.currentGame=void 0},s.prototype.reboot=function(){var r=this;r.status=s.STATUS.BOOTING,r.screen.playAnim(u.ANIM.CIRCLE,function(t,e){0===e?(r.status=s.STATUS.BOOTINGHALF,r.currentGame&&r.currentGame.onDestroy&&r.currentGame.onDestroy(),r.currentGame=null):1===e&&(r.status=s.STATUS.BOOTED)})},s.prototype.turnOff=function(){var r=this;r.status=s.STATUS.OFFING,r.screen.playAnim(u.ANIM.T2B,function(t,e){0===e?r.status=s.STATUS.OFFINGHALF:1===e&&(r.status=s.STATUS.OFFED,r.current=0,r.currentGame=null)})},s.prototype.onKeyUp=function(t){(function(t){if(this.status===s.STATUS.OFFED)return void("onoff"===t&&this.reboot());if(this.status===s.STATUS.BOOTED||this.status===s.STATUS.GAMEING){if("onoff"===t)return void this.turnOff();if(!this.games||this.games.length<1)return;if(this.currentGame)this.currentGame.onKeyup&&this.currentGame.onKeyup(t);else{if("rotate"===t)return void(this.current>=this.games.length-1?this.current=0:this.current++);if("start"===t)return void this.start()}if("reset"===t)return void this.reboot()}}).call(this,t)},s.prototype.onKeyDown=function(t){(function(t){if(this.status===s.STATUS.OFFED)return;if(this.status===s.STATUS.OFFINGHALF)return;if(!this.games||this.games.length<1)return;this.currentGame&&this.currentGame.onKeyDown&&this.currentGame.onKeyDown(t)}).call(this,t)},s.STATUS={BOOTING:2,BOOTINGHALF:3,BOOTED:4,GAMEING:5,OFFING:6,OFFINGHALF:7,OFFED:8},t.WzwLauncher=s}(window);