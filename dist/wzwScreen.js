/* wzwgame v1.0.0 by Microanswer,web:http://test.microanswer.cn/wzwgame/index.html */
!function(e){var i={width:190,height:250,atomRowCount:21,atomColCount:11,atomBorder:1.5,atomInset:2,atomSpace:3,splitPosition:.7,splitSize:1,fontSize:13,fontHeight:15,background:"#9facaa",color1:"#000000",color2:"#8f9997"},f={STRINGS:{score:"Score",best:"Best",level:"Level",pause:"PAUSE",fps:"FPS"}};function m(t,o){if("string"==typeof t)this.dom=document.querySelector(t);else{if("object"!=typeof t)throw new Error("未知的选择器。");t.jquery&&0<t.length?this.dom=t[0]:this.dom=t}this.option=m.assign({},i,o||{}),n.call(this),function(){var t=document.createElement("canvas");t.width=t.style.width=this.option.width,t.height=t.style.height=this.option.height,t.style.margin="0",t.style.padding="0",t.style.background=this.option.background,this.canvasDom=t,this.dom.appendChild(t),this.canvas=this.canvasDom.getContext("2d")}.call(this),function(){var t={};t.splitPosition=this.option.width*this.option.splitPosition,t.atomSpace=this.option.atomSpace||1,t.atomWidth=(t.splitPosition-t.atomSpace*(this.option.atomColCount+1))/this.option.atomColCount,t.atomHeight=(this.option.height-t.atomSpace*(this.option.atomRowCount+1))/this.option.atomRowCount,t.fontItalic="italic normal "+this.option.fontSize+"px arial",t.fontBold="normal bold "+this.option.fontSize+"px arial",this.drawParam=t}.call(this),function(){var o=this,i=0,n=-1;(function t(){o.fps=i,i=0,-1!==n&&clearTimeout(n),n=setTimeout(t,1e3)})(),function t(){i+=1,function(){this.logicFun&&this.logicFun()}.call(o),function(t){t.clearRect(0,0,this.option.width,this.option.height),t.save();var o=t.fillStyle;t.fillStyle=this.option.background,t.fillRect(0,0,this.option.width,this.option.height),t.fillStyle=o,function(a){var r=this,l=0,s=0,t=a.fillStyle,o=a.strokeStyle,i=a.lineWidth;m.each(r.option.atomRowCount,function(t,e){l+=r.drawParam.atomSpace,s=0,m.each(r.option.atomColCount,function(t,o){s+=r.drawParam.atomSpace;var i,n=0;r.atoms&&(n=r.atoms[e][o]),c.call(r,a,n,l,s),!r.animArr||(i=r.animArr[e][o])!==n&&1===i&&c.call(r,a,i,l,s),s+=r.drawParam.atomWidth}),l+=r.drawParam.atomHeight}),a.fillStyle=t,a.strokeStyle=o,a.lineWidth=i}.call(this,t);var i=t.strokeStyle,n=t.lineWidth;t.strokeStyle=this.option.color1,t.lineWidth=this.option.splitSize,t.moveTo(this.drawParam.splitPosition,0),t.lineTo(this.drawParam.splitPosition,this.option.height),t.stroke(),t.strokeStyle=i,t.lineWidth=n,function(n){var e=this,t=n.fillStyle,o=n.lineWidth,i=n.strokeStyle,a=n.font,r=e.option.fontHeight,l=e.drawParam.splitPosition+5;n.strokeStyle=e.option.color1,n.fillStyle=e.option.color1,n.font=e.drawParam.fontItalic,n.fillText(f.STRINGS.score,l,r),n.font=e.drawParam.fontBold,n.fillText(e.score,l,r+=e.option.fontHeight),n.font=e.drawParam.fontItalic,n.fillText(f.STRINGS.level,l,r+=e.option.fontHeight),n.font=e.drawParam.fontBold,n.fillText(e.level,l,r+=e.option.fontHeight);var s=r+5,h=l;m.each(4,function(t,i){s+=e.drawParam.atomSpace,h=l,m.each(4,function(t,o){h+=e.drawParam.atomSpace,c.call(e,n,e.statusAtoms?e.statusAtoms[i][o]:0,s,h),h+=e.drawParam.atomWidth}),s+=e.drawParam.atomHeight}),r=s+5,n.strokeStyle=n.fillStyle=e.option.color1,n.font=e.drawParam.fontItalic,n.fillText(f.STRINGS.best,l,r+=e.option.fontHeight),n.font=e.drawParam.fontBold,n.fillText(e.best,l,r+=e.option.fontHeight),r+=5,n.fillStyle=e.paused?e.option.color1:e.option.color2,n.font=e.drawParam.fontItalic,n.fillText(f.STRINGS.pause,l,r+=e.option.fontHeight),n.strokeStyle=n.fillStyle=e.option.color1,n.font=e.drawParam.fontItalic,n.fillText(f.STRINGS.fps,l,e.option.height-e.option.fontHeight-2),n.font=e.drawParam.fontBold,n.fillText(e.fps,l,e.option.height-2),n.font=a,n.strokeStyle=i,n.fillStyle=t,n.lineWidth=o}.call(this,t),t.restore()}.call(o,o.canvas),e.requestAnimationFrame?e.requestAnimationFrame(t):e.webkitRequestAnimationFrame?e.webkitRequestAnimationFrame(t):setTimeout(t,16)}()}.call(this)}function n(){this.atoms=void 0,this.statusAtoms=void 0,this.fps=60,this.score=0,this.paused=!1,this.level=0,this.best=0}function c(t,o,i,n){var e=this;t.strokeStyle=t.fillStyle=0<o?e.option.color1:e.option.color2,t.lineWidth=e.option.atomBorder,t.strokeRect(n,i,e.drawParam.atomWidth,e.drawParam.atomHeight),t.fillRect(n+e.option.atomInset,i+e.option.atomInset,e.drawParam.atomWidth-2*e.option.atomInset,e.drawParam.atomHeight-2*e.option.atomInset)}function l(i,o,n){var e,t,a=this;function r(t){var o=e[t];if(o)return a.animResult!==i?"kill":void(a.animArr=o)}o<i.animArr.length?(e=i.animArr[o],t=i.animTime[o],m.scroll(0,e.length,{goo:r,end:function(t){r(t),n&&n(i.animName,o),l.call(a,i,o+1,n)},kill:function(){n&&n(i.animName,-1)}},t)):a.animArr=void 0}function t(t){t=t||{},this.height=4,this.width=4,this.time=50,this.offsetRow=t.offsetRow,this.offsetCol=t.offsetCol,this.frams=[[[1,0,0,1],[0,1,1,0],[0,1,1,0],[1,0,0,1]],[[0,1,1,0],[1,0,0,1],[1,0,0,1],[0,1,1,0]]],this.currentFram=0,this.keepTime=t.keepTime||1e3;var o=this;setTimeout(function(){t.onEnd&&t.onEnd.call(o)},this.keepTime)}m.prototype.reset=function(){n.call(this)},m.prototype.makeNewArr=function(n){var o=this,e=[];return m.each(o.option.atomRowCount,function(t,i){e[i]=[],m.each(o.option.atomColCount,function(t,o){e[i][o]=n?n(i,o):0})}),e},m.prototype.playAnim=function(t,o){if(!t)throw new Error("请指定要执行的动画。");var i=this,n=t.call(i);if(n.animArr.length!==n.animTime.length)throw new Error("时间配置与动画不匹配。");i.animArr=i.makeNewArr(),i.animResult=n,l.call(i,n,0,o)},m.prototype.updateAtomArr=function(t){this.atoms=void 0,this.atoms=t},m.prototype.updateStatusAtoms=function(t){this.statusAtoms=void 0,this.statusAtoms=t},m.prototype.regLogic=function(t){this.logicFun=t},m.prototype.setLevel=function(t){this.level=t},m.prototype.setScore=function(t){this.score=t},m.prototype.setPause=function(t){this.paused=t},m.prototype.setBest=function(t){this.best=t},m.assign=function(){var t=arguments[0];if(t){for(var o=1;o<arguments.length;o++){var i=arguments[o];if(i)for(var n in i)t[n]=i[n]}return t}},m.each=function(t,o){if(t)if(Array.isArray(t))for(var i=0;i<t.length;i++)o&&o(t[i],i,t);else if(Number.isInteger(t))for(i=1;i<=t;i++)o&&o(i,i-1,t)},m.each2=function(n,e){n&&e&&m.each(n.length,function(t,i){m.each(t,function(t,o){e(t,i,o,n)})})},m.scroll=function(t,e,a,o){var r,l,s,h=t||0,f=e-h;0!=f?(r=!1,l=o||500,s=Date.now(),function n(){setTimeout(function(){var t=Date.now()-s,o=t/l,i=h+Math.floor(o*f);if(!r&&"kill"===(a&&a.goo&&a.goo(i)))return void(a.kill&&a.kill());l<=t?(r=!0,a.end(e)):setTimeout(n,1e3/60)},1e3/60)}()):a&&a.end&&a.end(e)},m.mergeArr=function(t,a,r,l,s){r=r||0,l=l||0,m.each(t,function(t,e){m.each(t,function(t,o){if(e+r<a.length&&o+l<a[e].length){var i=e+r,n=o+l;if(n<0||i<0)return;a[i][n]=s?s(i,n,e,o):t}})})},m.mergeArr2=function(n,t,e,a,r){e=e||0,a=a||0;var l=[];return m.each(t,function(t,i){l[i]=[],m.each(t,function(t,o){l[i][o]=t,e<=i&&a<=o&&i<e+n.length&&o<a+n[0].length&&(l[i][o]=r?r(i,o,i-e,o-a):n[i-e][o-a])})}),l},m.random=function(t,o){return Math.floor(Math.random()*(o-t)+t)},m.ANIM={CIRCLE:function(){for(var i=this,e=[],t="l",o=i.option.atomRowCount*i.option.atomColCount,n=function(){return this.makeNewArr(function(t,o){return[t,o]})}.call(i);e.length<o;){if("l"===t){for(r=0;r<n.length;r++)e.push(n[r].shift());t="b"}else if("b"===t){for(var a=n.pop(),r=0;r<a.length;r++)e.push(a[r]);t="r"}else if("r"===t){for(r=n.length-1;0<=r;r--)e.push(n[r].pop());t="t"}else if("t"===t){var l=n.shift();for(r=l.length-1;0<=r;r--)e.push(l[r]);t="l"}}var s=[];return m.each(e,function(t,o){var n=i.makeNewArr();m.each(o+1,function(t,o){var i=e[o];n[i[0]][i[1]]=1}),s.push(n)}),{animName:"CIRCLE",animArr:[s,s.concat([]).reverse()],animTime:[2e3,2e3]}},B2T:function(){var a=this,r=[];return m.each(a.option.atomRowCount,function(t,o){o=a.option.atomRowCount-t;for(var i=a.makeNewArr(),n=o;n<a.option.atomRowCount;n++)for(var e=0;e<a.option.atomColCount;e++)i[n][e]=1;r.push(i)}),{animName:"B2T",animArr:[r,r.concat([]).reverse()],animTime:[700,700]}},T2B:function(){var a=this,r=[];return m.each(a.option.atomRowCount,function(t,o){for(var i=a.makeNewArr(),n=0;n<=o;n++)for(var e=0;e<a.option.atomColCount;e++)i[n][e]=1;r.push(i)}),{animName:"T2B",animArr:[r,r.concat([]).reverse()],animTime:[700,700]}},COP:function(){for(var t=this,o=[],i=0,n=0,e=0;;){for(var a=i,r=t.option.atomRowCount-(i+1),l=t.makeNewArr(),n=0;n<=a;n++)for(e=0;e<t.option.atomColCount;e++)l[n][e]=1;for(n=t.option.atomRowCount-1;r<=n;n--)for(e=0;e<t.option.atomColCount;e++)l[n][e]=1;if(o.push(l),a===r||1===Math.abs(a-r))break;i++}return{animName:"COP",animArr:[o,o.concat([]).reverse()],animTime:[600,600]}}},m.LETTER={A:[[0,1,1,1,0],[1,0,0,0,1],[1,0,0,0,1],[1,1,1,1,1],[1,0,0,0,1]],B:[[1,1,1,1,0],[0,1,0,0,1],[0,1,1,1,0],[0,1,0,0,1],[1,1,1,1,0]],C:[[0,1,1,1,0],[1,0,0,0,1],[1,0,0,0,0],[1,0,0,0,1],[0,1,1,1,0]],D:[[1,1,1,1,0],[0,1,0,0,1],[0,1,0,0,1],[0,1,0,0,1],[1,1,1,1,0]],E:[[1,1,1,1,1],[1,0,0,0,0],[1,1,1,1,0],[1,0,0,0,0],[1,1,1,1,1]],F:[[1,1,1,1,1],[1,0,0,0,0],[1,1,1,1,0],[1,0,0,0,0],[1,0,0,0,0]],G:[[0,1,1,1,0],[1,0,0,0,0],[1,0,1,1,1],[1,0,0,0,1],[0,1,1,1,0]],H:[[1,0,0,0,1],[1,0,0,0,1],[1,1,1,1,1],[1,0,0,0,1],[1,0,0,0,1]],I:[[0,1,1,1,0],[0,0,1,0,0],[0,0,1,0,0],[0,0,1,0,0],[0,1,1,1,0]],J:[[0,1,1,1,0],[0,0,0,1,0],[0,0,0,1,0],[1,0,0,1,0],[0,1,1,0,0]],K:[[0,1,0,0,1],[0,1,0,1,0],[0,1,1,0,0],[0,1,0,1,0],[0,1,0,0,1]],L:[[1,0,0,0,0],[1,0,0,0,0],[1,0,0,0,0],[1,0,0,0,0],[1,1,1,1,0]],M:[[1,1,1,1,0],[1,0,1,0,1],[1,0,1,0,1],[1,0,1,0,1],[1,0,1,0,1]],N:[[1,0,0,0,1],[1,1,0,0,1],[1,0,1,0,1],[1,0,0,1,1],[1,0,0,0,1]],O:[[0,1,1,1,0],[1,0,0,0,1],[1,0,0,0,1],[1,0,0,0,1],[0,1,1,1,0]],P:[[1,1,1,1,0],[1,0,0,0,1],[1,1,1,1,0],[1,0,0,0,0],[1,0,0,0,0]],Q:[[0,1,1,0,0],[1,0,0,1,0],[1,0,0,1,0],[1,0,0,1,0],[0,1,1,1,1]],R:[[1,1,1,1,0],[1,0,0,0,1],[1,1,1,1,0],[1,0,1,0,0],[1,0,0,1,1]],S:[[0,1,1,1,1],[1,0,0,0,0],[0,1,1,1,0],[0,0,0,0,1],[1,1,1,1,0]],T:[[1,1,1,1,1],[0,0,1,0,0],[0,0,1,0,0],[0,0,1,0,0],[0,0,1,0,0]],U:[[1,0,0,0,1],[1,0,0,0,1],[1,0,0,0,1],[1,0,0,0,1],[0,1,1,1,0]],V:[[1,0,0,0,1],[1,0,0,0,1],[1,0,0,0,1],[0,1,0,1,0],[0,0,1,0,0]],W:[[1,0,1,0,1],[1,0,1,0,1],[1,0,1,0,1],[1,0,1,0,1],[1,1,1,1,0]],X:[[1,0,0,0,1],[0,1,0,1,0],[0,0,1,0,0],[0,1,0,1,0],[1,0,0,0,1]],Y:[[1,0,0,0,1],[0,1,0,1,0],[0,0,1,0,0],[0,0,1,0,0],[0,0,1,0,0]],Z:[[1,1,1,1,1],[0,0,0,1,0],[0,0,1,0,0],[0,1,0,0,0],[1,1,1,1,1]]},e.WzwScreen=m,t.prototype.update=function(){Date.now()-(this.lastTime||0)>=this.time&&(this.currentFram=0===this.currentFram?1:0,this.lastTime=Date.now())},t.prototype.getCurrentFrame=function(){return this.frams[this.currentFram]},e.WzwBomb=t}(window);