<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>王中王游戏机</title>
    <link rel="stylesheet" href="index.css">
    <script src="Clicker.js"></script>
    <script src="wzwScreen.js"></script>
    <script src="wzwLauncher.js"></script>
    <script src="gameTetris.js"></script>
    <script src="gameTank.js"></script>
</head>
<body>
<div class="pt-50 flex-page">
<div class="game">
    <div class="game-head">
        <div class="leftdoc"><img src="left.png"/></div>
        <div class="centerdoc">
            <div id="screen"></div>
            <div class="logo">
                <div class="text">
                    <a target="_blank" href="https://www.microanswer.cn">Microanswer</a>
                </div>
            </div>
        </div>
        <div class="rightdoc"><img src="right.png"/></div>
    </div>
    <div class="game-body">
        <table>
            <tr>
                <td>
                    <button class="btn hide">　</button>
                </td>
                <td>
                    <button class="btn" id="up" onmouseup="onKeyUp('up')" onmousedown="onKeyDown('up')">上</button>
                </td>
                <td>
                    <button class="btn hide">　</button>
                </td>
                <td>
                    <button class="btn hide">　</button>
                </td>
                <td>
                    <button class="btn hide">　</button>
                </td>
                <td>
                    <button class="btn hide">　</button>
                </td>
                <td>
                    <button class="btn hide">　</button>
                </td>
                <td rowspan="3">
                    <button class="big btn" id="rotate" onmouseup="onKeyUp('rotate')" onmousedown="onKeyDown('rotate')">旋转</button>
                </td>
            </tr>
            <tr>
                <td>
                    <button class="btn" id="left" onmouseup="onKeyUp('left')" onmousedown="onKeyDown('left')">左</button>
                </td>
                <td>
                    <button class="btn hide">　</button>
                </td>
                <td>
                    <button class="btn" id="right" onmouseup="onKeyUp('right')" onmousedown="onKeyDown('right')">右</button>
                </td>
                <td>
                    <button class="btn hide">　</button>
                </td>
                <td>
                    <button class="btn hide">　</button>
                </td>
                <td>
                    <button class="btn hide">　</button>
                </td>
                <td>
                    <button class="btn hide">　</button>
                </td>
            </tr>
            <tr>
                <td>
                    <button class="btn hide">　</button>
                </td>
                <td>
                    <button class="btn" id="down" onmouseup="onKeyUp('down')" onmousedown="onKeyDown('down')">下</button>
                </td>
                <td>
                    <button class="btn hide">　</button>
                </td>
                <td>
                    <button class="btn hide">　</button>
                </td>
                <td>
                    <button class="btn hide">　</button>
                </td>
                <td>
                    <button class="btn hide">　</button>
                </td>
                <td>
                    <button class="btn hide">　</button>
                </td>
                <td>
                    <button class="btn hide">　</button>
                </td>
            </tr>
            <tr>
                <td colspan="8">
                    <div style="height: 30px"></div>
                </td>
            </tr>
            <tr>
                <td>
                    <button class="btn hide">　</button>
                </td>
                <td>
                    <button class="btn hide">　</button>
                </td>
                <td>
                    <button class="btn small" id="start" onmouseup="onKeyUp('start')" onmousedown="onKeyDown('start')"></button>
                    <div class="text-center small">开始</div>
                </td>
                <td>
                    <button class="btn small" id="voice" onmouseup="onKeyUp('voice')" onmousedown="onKeyDown('voice')"></button>
                    <div class="text-center small">声音</div>
                </td>
                <td>
                    <button class="btn small" id="onoff" onmouseup="onKeyUp('onoff')" onmousedown="onKeyDown('onoff')"></button>
                    <div class="text-center small">开关</div>
                </td>
                <td>
                    <button class="btn small" id="reset" onmouseup="onKeyUp('reset')" onmousedown="onKeyDown('reset')"></button>
                    <div class="text-center small">复位</div>
                </td>
                <td>
                    <button class="btn hide">　</button>
                </td>
                <td>
                    <button class="btn hide">　</button>
                </td>
            </tr>
        </table>
    </div>
</div>
    <div class="right">

        <div class="txt-borad">
            <h3 class="text-center">掌上游戏机</h3>
            <div>
                一款在线模拟儿时的掌上游戏机。利用闲暇之时打磨的一款应用，希望能在无聊时体验一下它的乐趣。
                目前实现了《俄罗斯方块》和《坦克大战》这两筐游戏，还有更多游戏正在实现中。
            </div>
        </div>

        <div class="txt-borad mt-20">
            <h3 class="text-center">玩法介绍</h3>
            <div>
                <p>可以直接按键盘上对应按键操作。</p>
                <ul>
                    <li><kbd>W</kbd> 键： 上</li>
                    <li><kbd>A</kbd> 键： 左</li>
                    <li><kbd>S</kbd> 键： 下</li>
                    <li><kbd>D</kbd> 键： 右</li>
                    <li><kbd>空格</kbd> 键： 旋转</li>
                    <li><kbd>Z</kbd> 键： 开始</li>
                    <li><kbd>X</kbd> 键： 声音</li>
                    <li><kbd>C</kbd> 键： 开关</li>
                    <li><kbd>V</kbd> 键： 复位</li>
                </ul>
                <p>
                    按钮说明:
                    【上、下、左、右】这些按钮控制玩家移动。【旋转】切换各个游戏，在不同游戏内有不同的效果，例如变形、发射等。
                    【开始】选中某个游戏后点击开始即可游戏，进入游戏后点击开始则暂停，再次点击恢复。【声音】未实现。【开关】开关机。
                    【复位】任何时候点击复位都将直接回到初始界面。
                </p>
            </div>
        </div>
    </div>
</div>
<script>
    var launch = new WzwLauncher("#screen");
    launch.regGame("A", new Tetris());
    launch.regGame("B", new Tank());

    var clickers = {};

    function onKeyUp(key)   {
        launch.onKeyUp(key);
        upKey(key);

        var clicker = clickers[key];
        if (clicker) {
            clicker.release();
        }
    }
    function onKeyDown(key) {
        var clicker = clickers[key];
        if (!clicker) {
            clicker = clickers[key] = new Clicker();
            clicker.onClick(function () {
                launch.onKeyDown(key);
                downKey(key);
            });
        }
        clicker.push();
    }

    function upKey(key) {
        var btn = document.querySelector("#" + key);
        btn.className = btn.className.replace(/ active/g, "");
    }
    function downKey(key) {
        var btn = document.querySelector("#" + key);
        if (btn.className.indexOf("active") < 0) {
            btn.className = btn.className + " active";
        }
    }

    var keyUpMap = {
        "w": function () {onKeyUp("up")    },
        "a": function () {onKeyUp("left")  },
        "s": function () {onKeyUp("down")  },
        "d": function () {onKeyUp("right") },
        " ": function () {onKeyUp("rotate")},
        "z": function () {onKeyUp("start") },
        "x": function () {onKeyUp("voice") },
        "c": function () {onKeyUp("onoff") },
        "v": function () {onKeyUp("reset") },
    }

    var keyDownMap = {
        "w": function () {onKeyDown("up")    },
        "a": function () {onKeyDown("left")  },
        "s": function () {onKeyDown("down")  },
        "d": function () {onKeyDown("right") },
        " ": function () {onKeyDown("rotate")},
        "z": function () {onKeyDown("start") },
        "x": function () {onKeyDown("voice") },
        "c": function () {onKeyDown("onoff") },
        "v": function () {onKeyDown("reset") },
    }

    // 监听键盘。
    window.onkeyup = function (event) {
        var f = keyUpMap[String(event.key).toLowerCase()];
        f && f();
        event.stopPropagation();
    }
    window.onkeydown = function (event) {
        var f = keyDownMap[String(event.key).toLowerCase()];
        f && f();
        event.stopPropagation();
    }
</script>
</body>
</html>
